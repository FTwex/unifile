<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Test Unifile</title>
  </head>
  <body>
    <button id="authButton" type="button">Authorize GitHub</button>
    <input type="text" name="path" value="" id="path">
    <button id="lsButton" type="button">List all repos</button>
    <input type="text" name="path" value="" id="mkdirPath">
    <button id="mkdirButton" type="button">Create Folder</button>
    <input type="text" name="path" value="" id="putPath">
    <textarea name="content" id="putContent"></textarea>
    <button id="putButton" type="button">Create File</button>
    <h3>Result</h3>
    <p id='result'></p>
    <script type="text/javascript" charset="utf-8">
      var res = document.getElementById('result');
      var btn = document.getElementById('authButton');
      btn.onclick = function(){
        var req = new XMLHttpRequest();
        req.open('POST', '/GitHub/authorize', false);
        req.send();
        window.open(req.responseText);
      }
      var lsbtn = document.getElementById('lsButton');
      lsbtn.onclick = function(){
        var path = document.getElementById('path').value;
        var req = new XMLHttpRequest();
        req.open('GET', '/GitHub/ls/' + path, false);
        req.send();
        var result = JSON.parse(req.response);
        res.textContent = Array.isArray(result) ? result.map((repo) => repo.name).join('\n') : JSON.toString(result);
      }
      var mkbtn = document.getElementById('mkdirButton');
      mkbtn.onclick = function(){
        var path = document.getElementById('mkdirPath').value;
        var req = new XMLHttpRequest();
        req.open('PUT', '/GitHub/mkdir/' + path, false);
        req.send();
        var result = JSON.parse(req.response);
        res.textContent = Array.isArray(result) ? result.map((repo) => repo.name).join('\n') : JSON.toString(result);
      }
      var putBtn = document.getElementById('putButton');
      putBtn.onclick = function(){
        var path = document.getElementById('putPath').value;
        var content = document.getElementById('putContent').value;
        var req = new XMLHttpRequest();
        req.open('PUT', '/GitHub/put/' + path, false);
        req.setRequestHeader("Content-type", "application/json");
        req.setRequestHeader("Content-length", content.length);
        req.setRequestHeader("Connection", "close");
        req.send(JSON.stringify({"content": content}));
        var result = JSON.parse(req.response);
        res.textContent = Array.isArray(result) ? result.map((repo) => repo.name).join('\n') : JSON.stringify(result);
      }
    </script>
  </body>
</html>
